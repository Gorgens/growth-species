---
title: "02methods.Rmd"
output: html_document
---

```{r pacotes2, echo=FALSE, warning=FALSE, message=FALSE}
require(tidyverse)
require(magrittr)
require(reshape2)
require(ggplot2)
require(phytools)
require(knitr)
```

A base de dados estudada contém 28 inventários contínuos ocorridos nos estados do Pará, Amazonas, Acre, Rondônia e Mato Grossos, gerando a análise de 355 parcelas com 41580 indivíduos, que após descarte de árvores com diâmetros menores que 10 cm, e também as palmeiras, restaram 36283 árvores.  Os dados foram obtidos do projeto Paisagens Sustentáveis Brasil e estão disponíveis para download na plataforma do projeto  (https://www.embrapa.br/en/busca-de-solucoes-tecnologicas/-/produto-servico/3862/paisagens-sustentaveis).


```{r limparInventario, echo=FALSE, warning=FALSE, message=FALSE}
invMerged = read.csv("data/10_invPaisagensMerged.csv")
nParcelasAntes= length(unique(paste(invMerged$area, invMerged$plot)))
invMerged = invMerged %>%
  filter(type == "O" | is.na(type)) %>%
  drop_na(DBH) %>%
  filter(DBH >= 10)%>%
  mutate(date= as.Date(date)) %>%
  filter(date <Sys.Date()-365)
  
  
  

 nParcelasDepois= length(unique(paste(invMerged$area, invMerged$plot)))

```

```{r numeroParcelas, echo=FALSE, warning=FALSE, message=FALSE}
parcelasArea = invMerged %>%
  group_by(area, plot, subplot, year) %>%
  summarise(obs = n()) %>%
  group_by(area, year) %>%
  summarise(nplots = n())
 
```



Cada árvore teve o incremento diamétrico anual ($d_{growth}$) determinado pela da divisão do incremento diamétrico observado entre medições consecutivas, pelo período em anos entre as medições.

$$d_{growth} = \frac{d_f - d_i}{t_f - t_i}$$

em que $d_{growth}$ é o incremento diamétrico anual, $d_f$ é o diâmetro a 1,30 m obtido no último ano de medição, $d_i$ é o diâmetro a 1,30 m obtido no primeiro ano de medição, $t_f$ é a data da última medição e $t_i$ é a data da primeira medição. 

A taxa de crescimento diamétrico ($rGrowth$) foi calculado dividindo o incremento diamétrico anual pelo diâmetro a 1,30 obtido na primeira medição. Esta métrica é capaz de avaliar a taxa real de crescimento diamétrico sem a inflência do tamanho da árvore:

$$rGrowth = \frac{d_{growth}}{d_i}$$

em que $rGrowth$ é o incremento diamétrico relativo, $d_{growth}$ é o incremento diamétrico anual e $d_i$ é o diâmetro a 1,30 m obtido na primeira medição.



```{r pareamentoIncrementoSpeciesComercial, echo=FALSE, warning=FALSE, message=FALSE}

incComercial = invMerged %>%
  drop_na(GrupoEco) %>%
  filter(comercial == 1) %>%
  group_by(area,  plot, subplot, tree, scientific.name, GrupoEco) %>%
  summarise(med = n(),
            cc = min(cc), 
            minDBH = min(DBH), 
            maxDBH = max(DBH), 
            inc = max(DBH) - min(DBH), 
            intervMed = max(year) - min(year), 
            incAnual = ifelse(inc == 0, 0.01, inc / intervMed),
            rInc = incAnual / minDBH) %>%
  filter(med > 1)

```



##Seleção de espécies de interesse


```{r speciesInteresse, echo=FALSE, warning=FALSE, message=FALSE}
speciesOfInterest = c("Eschweilera coriacea", " Lecythis idatimon", "Manilkara huberi", "Tetragastris panamensis", "Inga marginata", "Lecythis lurida", "Pseudopiptadenia suaveolens", "Inga thibaudiana",  "Dialium guianense", "Neea oppositifolia", "Jacaranda copaia", "Nectandra cuspidata", "Laetia procera", "Tachigali paniculata",  "Minquartia guianensis", "Inga alba",  "Carapa guianensis", " Licania heteromorpha", "Zollernia paraensis", "Lecythis pisonis", "Dinizia excelsa", "Ocotea cernua", " Poecilanthe effusa")

   species01=incComercial %>%
   filter(scientific.name %in%speciesOfInterest) %>%
   group_by(area, scientific.name) %>%
   summarise(count = n()) %>%
   pivot_wider(names_from = scientific.name, values_from = count)
   
```


```{r pareamentoIncrementoSpeciesInteresse, echo=FALSE, warning=FALSE, message=FALSE}

incInteresse = invMerged %>%
  drop_na(GrupoEco) %>%
  filter(scientific.name %in%speciesOfInterest) %>%
  group_by(area, plot, subplot, tree, scientific.name, GrupoEco) %>%
  summarise(med = n(),
            cc = min(cc), 
            minDBH = min(DBH), 
            maxDBH = max(DBH), 
            inc = max(DBH) - min(DBH), 
            intervMed = max(year) - min(year), 
            incAnual = ifelse(inc == 0, 0.01, inc / intervMed),
            rInc = incAnual / minDBH) %>%
  filter(med > 1)

```

